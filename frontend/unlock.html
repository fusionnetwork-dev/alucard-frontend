<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <script src="js/config.js"></script>
 
  <title>alucard - unlock whitelist</title>
  <style>
    /* ==== GLOBAL STYLES ==== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }

    /* ==== BACKGROUND ==== */
    .bg-orbs {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      animation: float 20s infinite ease-in-out;
    }
    .orb1 {
      width: 500px; height: 500px;
      background: radial-gradient(circle, #ff0000, transparent);
      top: -200px; right: -100px;
    }
    .orb2 {
      width: 400px; height: 400px;
      background: radial-gradient(circle, #8b0000, transparent);
      bottom: -150px; left: -100px;
      animation-delay: 5s;
    }
    @keyframes float {
      0%,100%{transform:translate(0,0)scale(1)}
      33%{transform:translate(100px,-100px)scale(1.1)}
      66%{transform:translate(-100px,100px)scale(0.9)}
    }

    /* ==== NAVBAR ==== */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 4%;
      background: rgba(10,10,10,0.6);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .logo { 
      font-size: 1.5rem; 
      font-weight: 600; 
      color: #fff; 
      letter-spacing: -0.5px;
      text-decoration: none;
    }
    .logo span { color: #ff3333; }

    /* ==== MAIN ==== */
    .container { max-width: 900px; margin: 4rem auto; padding: 0 2rem; }
    .unlock-card {
      background: rgba(255,255,255,0.03);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 3rem;
      text-align: center;
    }
    .unlock-card h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    .unlock-card .subtitle {
      color: rgba(255,255,255,0.6);
      margin-bottom: 3rem;
      font-size: 1.1rem;
    }

    /* ==== INFO BOX ==== */
    .info-box {
      background: rgba(255,51,51,0.1);
      border: 1px solid rgba(255,51,51,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: left;
    }
    .info-box h3 { margin-bottom: .5rem; color: #ff6666; }
    .info-box p { color: rgba(255,255,255,0.7); line-height: 1.6; }

    .warning-box {
      background: rgba(255,165,0,0.1);
      border: 1px solid rgba(255,165,0,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: left;
    }
    .warning-box h3 { margin-bottom: .5rem; color: #ffa500; }
    .warning-box p { color: rgba(255,255,255,0.7); line-height: 1.6; }

    /* ==== PROGRESS BAR ==== */
    .progress-container { margin: 2rem 0; }
    .progress-bar {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      height: 12px;
      overflow: hidden;
      position: relative;
    }
    .progress-fill {
      background: linear-gradient(90deg,#ff0000,#ff3333);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      box-shadow: 0 0 20px rgba(255,51,51,0.5);
    }
    .progress-text {
      margin-top: 1rem;
      color: rgba(255,255,255,0.7);
      font-size: 0.95rem;
    }

    /* ==== STEPS ==== */
    .steps-container {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 1.5rem;
      margin: 3rem 0;
    }
    .step-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 2rem;
      position: relative;
      transition: all .3s;
    }
    .step-card.active {
      border-color: #ff3333;
      box-shadow: 0 0 20px rgba(255,51,51,0.2);
      transform: translateY(-5px);
    }
    .step-card.completed {
      border-color: rgba(0,255,0,0.5);
      background: rgba(0,255,0,0.05);
    }
    .step-number {
      position: absolute;
      top: -15px;
      left: 20px;
      background: #ff3333;
      width: 30px; height: 30px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.9rem;
      transition: all .3s;
    }
    .step-card.completed .step-number { 
      background: #00ff00; 
      animation: checkmark 0.5s ease;
    }
    
    @keyframes checkmark {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .step-card h3 {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .step-card p {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .ad-button {
      background: #ff3333;
      border: none;
      border-radius: 10px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all .3s;
      margin-top: 1rem;
      width: 100%;
      font-size: 0.95rem;
    }
    .ad-button:hover:not(:disabled) {
      background: #ff0000;
      box-shadow: 0 4px 20px rgba(255,51,51,0.4);
      transform: translateY(-2px);
    }
    .ad-button:disabled { 
      opacity: .5; 
      cursor: not-allowed;
      transform: none;
    }
    .timer { 
      color: #ff3333; 
      font-weight: 700; 
      margin-top: .5rem;
      font-size: 1.1rem;
      display: none;
    }

    /* ==== SUCCESS BOX ==== */
    .success-message {
      display: none;
      background: rgba(0,255,0,0.1);
      border: 1px solid rgba(0,255,0,0.3);
      border-radius: 12px;
      padding: 2rem;
      margin-top: 2rem;
      animation: slideIn 0.5s ease;
    }
    .success-message.show { display: block; }
    .success-message h2 { 
      color: #00ff00; 
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }
    .success-message p {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hwid-display {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 1rem;
      font-family: monospace;
      margin: 1rem 0;
      word-break: break-all;
      font-size: 0.95rem;
      color: #00ff00;
    }
    
    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .copy-btn, .add-device-btn, .dashboard-btn {
      flex: 1;
      min-width: 150px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: .8rem 1.5rem;
      color: white;
      font-size: .9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .3s;
    }
    
    .add-device-btn {
      background: rgba(255,51,51,0.2);
      border-color: rgba(255,51,51,0.4);
      color: #ff6666;
    }

    .dashboard-btn {
      background: rgba(51,153,255,0.2);
      border-color: rgba(51,153,255,0.4);
      color: #66b3ff;
    }

    .copy-btn:hover { 
      background: rgba(255,255,255,0.15);
      transform: translateY(-2px);
    }

    .add-device-btn:hover {
      background: rgba(255,51,51,0.3);
      transform: translateY(-2px);
    }

    .dashboard-btn:hover {
      background: rgba(51,153,255,0.3);
      transform: translateY(-2px);
    }

    .devices-list {
      margin-top: 2rem;
      text-align: left;
    }

    .devices-list h3 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: #00ff00;
    }

    .device-item {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .device-hwid {
      font-family: monospace;
      color: rgba(255,255,255,0.9);
      font-size: 0.9rem;
    }

    .device-time {
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }

    .loading {
      opacity: 0.5;
      pointer-events: none;
    }

    .error-message {
      background: rgba(255,0,0,0.1);
      border: 1px solid rgba(255,0,0,0.3);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      color: #ff6666;
      display: none;
    }

    .error-message.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    .cooldown-message {
      background: rgba(255,165,0,0.1);
      border: 1px solid rgba(255,165,0,0.3);
      border-radius: 12px;
      padding: 2rem;
      margin-top: 2rem;
      text-align: center;
    }

    .cooldown-message h2 {
      color: #ffa500;
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    .cooldown-message p {
      color: rgba(255,255,255,0.8);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .cooldown-timer {
      font-size: 2rem;
      font-weight: 700;
      color: #ffa500;
      margin: 1.5rem 0;
    }

    @media (max-width: 768px) {
      .steps-container {
        grid-template-columns: 1fr;
      }
      
      .button-group {
        flex-direction: column;
      }

      .copy-btn, .add-device-btn, .dashboard-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="bg-orbs">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
  </div>

  <nav>
    <a href="index.html" class="logo">alu<span>card</span></a>
    <a href="dashboard.html" style="color:rgba(255,255,255,0.7);text-decoration:none;font-weight:500;">dashboard</a>
  </nav>

  <div class="container">
    <div class="unlock-card">
      <h1>unlock whitelist access</h1>
      <p class="subtitle">complete 3 quick checkpoints to whitelist your device</p>

      <div class="info-box">
        <h3>💡 why checkpoints?</h3>
        <p>Running a free service requires infrastructure costs. These quick checkpoints (15 seconds each) help us keep Alucard completely free for everyone. No premium plans, no paywalls, just 45 seconds of your time.</p>
      </div>

      <div class="warning-box">
        <h3>⚠️ rate limit notice</h3>
        <p><strong>Three unlocks per 24 hours per IP address.</strong> This prevents abuse and ensures fair access for everyone. Plan accordingly!</p>
      </div>

      <div class="progress-container">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p class="progress-text"><span id="completed-count">0</span> of 3 checkpoints completed</p>
      </div>

      <div class="steps-container">
        <!-- Step 1 -->
        <div class="step-card active" id="step-1">
          <div class="step-number">1</div>
          <h3>checkpoint one</h3>
          <p>Alucard provides enterprise-grade script protection with military-level encryption, completely free.</p>
          <button class="ad-button" id="ad-btn-1">Start Checkpoint</button>
          <div class="timer" id="timer-1"></div>
        </div>

        <!-- Step 2 -->
        <div class="step-card" id="step-2">
          <div class="step-number">2</div>
          <h3>checkpoint two</h3>
          <p>With real-time analytics, webhook integration, and global CDN delivery, your scripts are protected and fast.</p>
          <button class="ad-button" id="ad-btn-2" disabled>Start Checkpoint</button>
          <div class="timer" id="timer-2"></div>
        </div>

        <!-- Step 3 -->
        <div class="step-card" id="step-3">
          <div class="step-number">3</div>
          <h3>final checkpoint</h3>
          <p>Join thousands of developers using Alucard for HWID locking, blacklist management, and API access.</p>
          <button class="ad-button" id="ad-btn-3" disabled>Start Checkpoint</button>
          <div class="timer" id="timer-3"></div>
        </div>
      </div>

      <div class="error-message" id="error-message"></div>

      <div class="success-message" id="success-message">
        <h2>🎉 whitelist unlocked!</h2>
        <p>Your device has been successfully whitelisted. You now have permanent access to Alucard.</p>
        <div class="hwid-display" id="hwid-display"></div>
        
        <div class="button-group">
          <button class="copy-btn" onclick="copyHWID(event)">📋 Copy HWID</button>
          <button class="add-device-btn" onclick="addAnotherDevice()">➕ Add Another Device</button>
          <button class="dashboard-btn" onclick="goToDashboard()">📊 Go to Dashboard</button>
        </div>

        <div class="devices-list" id="devices-list" style="display:none;">
          <h3>Your Whitelisted Devices:</h3>
          <div id="devices-container"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const TOTAL_STEPS = 3;
    let completedSteps = 0;
    let userHWID = null;
    let whitelistedDevices = [];
    let sessionTokens = {};

    function generateHWID() {
      return 'HWID-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    }

    function updateProgress() {
      const percent = (completedSteps / TOTAL_STEPS) * 100;
      document.getElementById('progress-fill').style.width = percent + '%';
      document.getElementById('completed-count').textContent = completedSteps;
    }

    function showError(message) {
      const errorEl = document.getElementById('error-message');
      errorEl.textContent = message;
      errorEl.classList.add('show');
      setTimeout(() => errorEl.classList.remove('show'), 8000);
    }

    function showCooldownMessage(timeRemaining) {
      const card = document.querySelector('.unlock-card');
      const hours = Math.floor(timeRemaining / 3600000);
      const minutes = Math.floor((timeRemaining % 3600000) / 60000);
      
      card.innerHTML = `
        <div class="cooldown-message">
          <h2>⏰ rate limit active</h2>
          <p>You've already unlocked a device from this IP address in the last 24 hours.</p>
          <div class="cooldown-timer" id="cooldown-timer">
            ${hours}h ${minutes}m remaining
          </div>
          <p>This limit prevents abuse and ensures fair access for all users. You can unlock another device after the cooldown expires.</p>
          <div class="button-group" style="justify-content: center; margin-top: 2rem;">
            <button class="dashboard-btn" onclick="goToDashboard()">📊 Go to Dashboard</button>
          </div>
        </div>
      `;
      
      // Update timer every minute
      setInterval(() => {
        const now = Date.now();
        const remaining = timeRemaining - (now - Date.now());
        if (remaining > 0) {
          const h = Math.floor(remaining / 3600000);
          const m = Math.floor((remaining % 3600000) / 60000);
          const timerEl = document.getElementById('cooldown-timer');
          if (timerEl) {
            timerEl.textContent = `${h}h ${m}m remaining`;
          }
        } else {
          location.reload();
        }
      }, 60000);
    }

    async function startAd(stepNum) {
      const btn = document.getElementById(`ad-btn-${stepNum}`);
      const timer = document.getElementById(`timer-${stepNum}`);
      const card = document.getElementById(`step-${stepNum}`);
      
      btn.disabled = true;
      btn.textContent = 'Connecting...';
      card.classList.add('loading');

      try {
        const response = await fetch(`${API_URL}/api/ad-start`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            userId: localStorage.getItem('alucard_user_id') || 'guest', 
            step: stepNum 
          })
        });

        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Failed to start checkpoint');
        }

        if (data.alreadyCompleted) {
          completeStep(stepNum, true);
          return;
        }

        sessionTokens[stepNum] = data.sessionToken;
        card.classList.remove('loading');
        startTimer(stepNum);
        setTimeout(() => completeStep(stepNum), 15000);
      } catch (e) {
        showError('Error starting checkpoint: ' + e.message);
        btn.disabled = false;
        btn.textContent = 'Start Checkpoint';
        card.classList.remove('loading');
      }
    }

    function startTimer(stepNum) {
      const timer = document.getElementById(`timer-${stepNum}`);
      const btn = document.getElementById(`ad-btn-${stepNum}`);
      let seconds = 15;
      
      btn.style.display = 'none';
      timer.style.display = 'block';
      timer.textContent = `Please wait ${seconds}s...`;
      
      const interval = setInterval(() => {
        seconds--;
        if (seconds > 0) {
          timer.textContent = `Please wait ${seconds}s...`;
        } else {
          clearInterval(interval);
          timer.textContent = 'Verifying...';
        }
      }, 1000);
    }

    async function completeStep(stepNum, skipAPI = false) {
      const card = document.getElementById(`step-${stepNum}`);
      const btn = document.getElementById(`ad-btn-${stepNum}`);
      const timer = document.getElementById(`timer-${stepNum}`);

      if (!skipAPI) {
        try {
          const response = await fetch(`${API_URL}/api/ad-complete`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionToken: sessionTokens[stepNum] })
          });

          if (!response.ok) {
            const data = await response.json();
            throw new Error(data.error || 'Failed to complete checkpoint');
          }
        } catch (e) {
          showError('Verification failed: ' + e.message);
          btn.disabled = false;
          btn.textContent = 'Start Checkpoint';
          btn.style.display = 'block';
          timer.style.display = 'none';
          return;
        }
      }

      card.classList.remove('active', 'loading');
      card.classList.add('completed');
      timer.style.display = 'none';
      btn.textContent = '✓ Completed';
      btn.style.background = '#00ff00';
      btn.style.display = 'block';

      completedSteps++;
      updateProgress();

      if (stepNum < TOTAL_STEPS) {
        const next = stepNum + 1;
        document.getElementById(`step-${next}`).classList.add('active');
        document.getElementById(`ad-btn-${next}`).disabled = false;
      } else {
        setTimeout(() => unlockWhitelist(), 500);
      }
    }

    async function unlockWhitelist() {
      userHWID = generateHWID();
      
      try {
        const response = await fetch(`${API_URL}/api/unlock-whitelist`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            hwid: userHWID,
            userId: localStorage.getItem('alucard_user_id') || 'guest'
          })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          // Check if it's the 24-hour cooldown error
          if (data.error && data.error.includes('24 hours')) {
            showError('⏰ Rate Limit: ' + data.error);
            if (data.timeRemaining) {
              setTimeout(() => showCooldownMessage(data.timeRemaining), 2000);
            }
            return;
          }
          throw new Error(data.error || 'Failed to unlock whitelist');
        }

        if (data.success) {
          whitelistedDevices.push({
            hwid: userHWID,
            time: new Date().toLocaleString()
          });
          displaySuccess();
        }
      } catch (err) {
        showError('Error unlocking whitelist: ' + err.message);
      }
    }

    function displaySuccess() {
      document.getElementById('hwid-display').textContent = userHWID;
      document.getElementById('success-message').classList.add('show');
      
      if (whitelistedDevices.length > 1) {
        displayDevicesList();
      }
    }

    function displayDevicesList() {
      const listEl = document.getElementById('devices-list');
      const containerEl = document.getElementById('devices-container');
      
      containerEl.innerHTML = whitelistedDevices.map((device, i) => `
        <div class="device-item">
          <div>
            <div class="device-hwid">${device.hwid}</div>
            <div class="device-time">Added: ${device.time}</div>
          </div>
        </div>
      `).join('');
      
      listEl.style.display = 'block';
    }

    function addAnotherDevice() {
      showError('⚠️ Remember: Only three unlocks per 24 hours per IP address. You may hit the rate limit.');
      setTimeout(() => {
        // Reset for another device
        completedSteps = 0;
        sessionTokens = {};
        updateProgress();
        
        // Hide success message
        document.getElementById('success-message').classList.remove('show');
        
        // Reset all steps
        for (let i = 1; i <= TOTAL_STEPS; i++) {
          const card = document.getElementById(`step-${i}`);
          const btn = document.getElementById(`ad-btn-${i}`);
          const timer = document.getElementById(`timer-${i}`);
          
          card.classList.remove('completed', 'active', 'loading');
          btn.disabled = true;
          btn.textContent = 'Start Checkpoint';
          btn.style.background = '#ff3333';
          btn.style.display = 'block';
          timer.style.display = 'none';
        }
        
        // Activate first step
        document.getElementById('step-1').classList.add('active');
        document.getElementById('ad-btn-1').disabled = false;
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 3000);
    }

    function copyHWID(event) {
      const hwid = document.getElementById('hwid-display').textContent;
      navigator.clipboard.writeText(hwid);
      const btn = event.target;
      const old = btn.textContent;
      btn.textContent = '✓ Copied!';
      setTimeout(() => btn.textContent = old, 2000);
    }

    function goToDashboard() {
      window.location.href = 'dashboard.html';
    }

    // Initialize
    updateProgress();
    document.getElementById('ad-btn-1').addEventListener('click', () => startAd(1));
    document.getElementById('ad-btn-2').addEventListener('click', () => startAd(2));
    document.getElementById('ad-btn-3').addEventListener('click', () => startAd(3));
  </script>
</body>
</html>
