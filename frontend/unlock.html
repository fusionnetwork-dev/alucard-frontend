<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <script src="js/config.js"></script>
 
  <title>alucard - unlock whitelist</title>
  <style>
    /* ==== GLOBAL STYLES ==== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }

    /* ==== BACKGROUND ==== */
    .bg-orbs {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      animation: float 20s infinite ease-in-out;
    }
    .orb1 {
      width: 500px; height: 500px;
      background: radial-gradient(circle, #ff0000, transparent);
      top: -200px; right: -100px;
    }
    .orb2 {
      width: 400px; height: 400px;
      background: radial-gradient(circle, #8b0000, transparent);
      bottom: -150px; left: -100px;
      animation-delay: 5s;
    }
    @keyframes float {
      0%,100%{transform:translate(0,0)scale(1)}
      33%{transform:translate(100px,-100px)scale(1.1)}
      66%{transform:translate(-100px,100px)scale(0.9)}
    }

    /* ==== NAVBAR ==== */
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 4%;
      background: rgba(10,10,10,0.6);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .logo { 
      font-size: 1.5rem; 
      font-weight: 600; 
      color: #fff; 
      letter-spacing: -0.5px;
      text-decoration: none;
    }
    .logo span { color: #ff3333; }

    /* ==== MAIN ==== */
    .container { max-width: 900px; margin: 4rem auto; padding: 0 2rem; }
    .unlock-card {
      background: rgba(255,255,255,0.03);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 3rem;
      text-align: center;
    }
    .unlock-card h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    .unlock-card .subtitle {
      color: rgba(255,255,255,0.6);
      margin-bottom: 3rem;
      font-size: 1.1rem;
    }

    /* ==== INFO BOX ==== */
    .info-box {
      background: rgba(255,51,51,0.1);
      border: 1px solid rgba(255,51,51,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: left;
    }
    .info-box h3 { margin-bottom: .5rem; color: #ff6666; }
    .info-box p { color: rgba(255,255,255,0.7); line-height: 1.6; }

    .warning-box {
      background: rgba(255,165,0,0.1);
      border: 1px solid rgba(255,165,0,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: left;
    }
    .warning-box h3 { margin-bottom: .5rem; color: #ffa500; }
    .warning-box p { color: rgba(255,255,255,0.7); line-height: 1.6; }

    /* ==== PROGRESS BAR ==== */
    .progress-container { margin: 2rem 0; }
    .progress-bar {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      height: 12px;
      overflow: hidden;
      position: relative;
    }
    .progress-fill {
      background: linear-gradient(90deg,#ff0000,#ff3333);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      box-shadow: 0 0 20px rgba(255,51,51,0.5);
    }
    .progress-text {
      margin-top: 1rem;
      color: rgba(255,255,255,0.7);
      font-size: 0.95rem;
    }

    /* ==== STEPS ==== */
    .steps-container {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 1.5rem;
      margin: 3rem 0;
    }
    .step-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 2rem;
      position: relative;
      transition: all .3s;
    }
    .step-card.active {
      border-color: #ff3333;
      box-shadow: 0 0 20px rgba(255,51,51,0.2);
      transform: translateY(-5px);
    }
    .step-card.completed {
      border-color: rgba(0,255,0,0.5);
      background: rgba(0,255,0,0.05);
    }
    .step-number {
      position: absolute;
      top: -15px;
      left: 20px;
      background: #ff3333;
      width: 30px; height: 30px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.9rem;
      transition: all .3s;
    }
    .step-card.completed .step-number { 
      background: #00ff00; 
      animation: checkmark 0.5s ease;
    }
    
    @keyframes checkmark {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .step-card h3 {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .step-card p {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .ad-button {
      background: #ff3333;
      border: none;
      border-radius: 10px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all .3s;
      margin-top: 1rem;
      width: 100%;
      font-size: 0.95rem;
    }
    .ad-button:hover:not(:disabled) {
      background: #ff0000;
      box-shadow: 0 4px 20px rgba(255,51,51,0.4);
      transform: translateY(-2px);
    }
    .ad-button:disabled { 
      opacity: .5; 
      cursor: not-allowed;
      transform: none;
    }
    .timer { 
      color: #ff3333; 
      font-weight: 700; 
      margin-top: .5rem;
      font-size: 1.1rem;
      display: none;
    }

    /* ==== SUCCESS BOX ==== */
    .success-message {
      display: none;
      background: rgba(0,255,0,0.1);
      border: 1px solid rgba(0,255,0,0.3);
      border-radius: 12px;
      padding: 2rem;
      margin-top: 2rem;
      animation: slideIn 0.5s ease;
    }
    .success-message.show { display: block; }
    .success-message h2 { 
      color: #00ff00; 
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }
    .success-message p {
      color: rgba(255,255,255,0.8);
      margin-bottom: 1rem;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hwid-display {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 1rem;
      font-family: monospace;
      margin: 1rem 0;
      word-break: break-all;
      font-size: 0.95rem;
      color: #00ff00;
    }
    
    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .copy-btn, .add-device-btn, .dashboard-btn {
      flex: 1;
      min-width: 150px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: .8rem 1.5rem;
      color: white;
      font-size: .9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .3s;
    }
    
    .add-device-btn {
      background: rgba(255,51,51,0.2);
      border-color: rgba(255,51,51,0.4);
      color: #ff6666;
    }

    .dashboard-btn {
      background: rgba(51,153,255,0.2);
      border-color: rgba(51,153,255,0.4);
      color: #66b3ff;
    }

    .copy-btn:hover { 
      background: rgba(255,255,255,0.15);
      transform: translateY(-2px);
    }

    .add-device-btn:hover {
      background: rgba(255,51,51,0.3);
      transform: translateY(-2px);
    }

    .dashboard-btn:hover {
      background: rgba(51,153,255,0.3);
      transform: translateY(-2px);
    }

    .loading {
      opacity: 0.5;
      pointer-events: none;
    }

    .error-message {
      background: rgba(255,0,0,0.1);
      border: 1px solid rgba(255,0,0,0.3);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      color: #ff6666;
      display: none;
    }

    .error-message.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @media (max-width: 768px) {
      .steps-container {
        grid-template-columns: 1fr;
      }
      
      .button-group {
        flex-direction: column;
      }

      .copy-btn, .add-device-btn, .dashboard-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="bg-orbs">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
  </div>

  <nav>
    <a href="index.html" class="logo">alu<span>card</span></a>
    <a href="dashboard.html" style="color:rgba(255,255,255,0.7);text-decoration:none;font-weight:500;">dashboard</a>
  </nav>

  <div class="container">
    <div class="unlock-card">
      <h1>unlock whitelist access</h1>
      <p class="subtitle">complete 3 quick checkpoints to generate your ALUCARD key</p>

      <div class="info-box">
        <h3>üí° how it works</h3>
        <p>Complete 3 simple checkpoints to generate your unique ALUCARD key. Then add it to your dashboard to whitelist your device. Running a free service requires infrastructure costs - these quick checkpoints help us keep Alucard completely free for everyone.</p>
      </div>

      <div class="warning-box">
        <h3>‚ö†Ô∏è important</h3>
        <p><strong>Complete each checkpoint task fully.</strong> Each checkpoint opens in a new tab - follow the instructions, complete the task, and return here to continue. Progress is tracked automatically.</p>
      </div>

      <div class="progress-container">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <p class="progress-text"><span id="completed-count">0</span> of 3 checkpoints completed</p>
      </div>

      <div class="steps-container">
        <!-- Step 1 -->
        <div class="step-card active" id="step-1">
          <div class="step-number">1</div>
          <h3>checkpoint one</h3>
          <p>Alucard provides enterprise-grade script protection with military-level encryption, completely free.</p>
          <button class="ad-button" id="ad-btn-1">Start Checkpoint</button>
          <div class="timer" id="timer-1"></div>
        </div>

        <!-- Step 2 -->
        <div class="step-card" id="step-2">
          <div class="step-number">2</div>
          <h3>checkpoint two</h3>
          <p>With real-time analytics, webhook integration, and global CDN delivery, your scripts are protected and fast.</p>
          <button class="ad-button" id="ad-btn-2" disabled>Start Checkpoint</button>
          <div class="timer" id="timer-2"></div>
        </div>

        <!-- Step 3 -->
        <div class="step-card" id="step-3">
          <div class="step-number">3</div>
          <h3>final checkpoint</h3>
          <p>Join thousands of developers using Alucard for HWID locking, blacklist management, and API access.</p>
          <button class="ad-button" id="ad-btn-3" disabled>Start Checkpoint</button>
          <div class="timer" id="timer-3"></div>
        </div>
      </div>

      <div class="error-message" id="error-message"></div>

      <div class="success-message" id="success-message">
        <h2>üéâ ALUCARD key generated!</h2>
        <p>Copy your key below and add it to your dashboard to whitelist your device.</p>
        <div class="hwid-display" id="hwid-display"></div>
        
        <div class="button-group">
          <button class="copy-btn" onclick="copyHWID(event)">üìã Copy Key</button>
          <button class="dashboard-btn" onclick="goToDashboard()">üìä Add to Dashboard</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========================================
    // MONETIZATION CONFIG
    // ========================================
    // Replace these with your actual IDs from the ad networks
    const LINKVERTISE_USER_ID = 'YOUR_LINKVERTISE_USER_ID'; // Get from linkvertise.com
    const LOOTLABS_API_KEY = 'YOUR_LOOTLABS_API_KEY'; // Get from loot-labs.com/dashboard

    const TOTAL_STEPS = 3;
    let completedSteps = 0;
    let userHWID = null;
    let sessionTokens = {};
    let pollIntervals = {};

    // ========================================
    // AUTHENTICATION
    // ========================================
    function checkAuth() {
      const token = localStorage.getItem('alucard_token');
      const user = localStorage.getItem('alucard_user');
      
      console.log('Unlock page - Token exists:', !!token);
      console.log('Unlock page - User exists:', !!user);
      
      if (!token || !user) {
        console.log('No auth found, redirecting to auth page');
        window.location.href = 'auth.html';
        return false;
      }
      return true;
    }

    if (!checkAuth()) {
      throw new Error('Not authenticated');
    }

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    function generateHWID() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = 'ALUCARD-';
      for (let i = 0; i < 32; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function updateProgress() {
      const percent = (completedSteps / TOTAL_STEPS) * 100;
      document.getElementById('progress-fill').style.width = percent + '%';
      document.getElementById('completed-count').textContent = completedSteps;
    }

    function showError(message) {
      const errorEl = document.getElementById('error-message');
      errorEl.textContent = message;
      errorEl.classList.add('show');
      setTimeout(() => errorEl.classList.remove('show'), 8000);
    }

    // ========================================
    // MONETIZATION LINKS
    // ========================================
    function openMonetizationLink(stepNum, sessionToken) {
      const baseUrl = window.location.origin + window.location.pathname;
      const returnUrl = baseUrl + '?verify=' + sessionToken;
      
      let adUrl;
      
      if (stepNum === 1 || stepNum === 3) {
        // Linkvertise for steps 1 and 3
        // Format: https://link-to.net/YOUR_USER_ID/dynamic-slug
        const slug = `alucard-checkpoint-${stepNum}`;
        adUrl = `https://link-to.net/${LINKVERTISE_USER_ID}/${slug}?o=${encodeURIComponent(returnUrl)}`;
      } else {
        // Loot-Labs for step 2
        // Format: https://loot-link.com/s?YOUR_API_KEY
        adUrl = `https://loot-link.com/s?${LOOTLABS_API_KEY}`;
      }
      
      console.log('Opening monetization link:', adUrl);
      window.open(adUrl, '_blank', 'noopener,noreferrer');
    }

    // ========================================
    // AD FLOW
    // ========================================
    async function startAd(stepNum) {
      const btn = document.getElementById(`ad-btn-${stepNum}`);
      const timer = document.getElementById(`timer-${stepNum}`);
      const card = document.getElementById(`step-${stepNum}`);
      
      btn.disabled = true;
      btn.textContent = 'Opening checkpoint...';
      card.classList.add('loading');

      const user = JSON.parse(localStorage.getItem('alucard_user') || '{}');
      const token = localStorage.getItem('alucard_token');

      try {
        console.log('Starting checkpoint', stepNum);
        const response = await fetch(`${API_URL}/api/ad-start`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ 
            userId: user.id || 'guest', 
            step: stepNum 
          })
        });

        const data = await response.json();
        console.log('Ad start response:', data);
        
        if (!response.ok) {
          throw new Error(data.error || 'Failed to start checkpoint');
        }

        if (data.alreadyCompleted) {
          completeStep(stepNum, true);
          return;
        }

        sessionTokens[stepNum] = data.sessionToken;
        
        // Open the monetization link
        openMonetizationLink(stepNum, data.sessionToken);
        
        card.classList.remove('loading');
        btn.textContent = 'Complete task & return here';
        btn.style.background = 'rgba(255,165,0,0.3)';
        
        // Start verification polling
        startVerificationPolling(stepNum);
      } catch (e) {
        console.error('Error starting ad:', e);
        showError('Error starting checkpoint: ' + e.message);
        btn.disabled = false;
        btn.textContent = 'Start Checkpoint';
        card.classList.remove('loading');
      }
    }

    function startVerificationPolling(stepNum) {
      const timer = document.getElementById(`timer-${stepNum}`);
      
      timer.style.display = 'block';
      timer.textContent = 'Waiting for completion...';
      
      let attempts = 0;
      const maxAttempts = 180; // 6 minutes (180 * 2 seconds)
      
      pollIntervals[stepNum] = setInterval(async () => {
        attempts++;
        
        if (attempts > maxAttempts) {
          clearInterval(pollIntervals[stepNum]);
          showError('Checkpoint timed out. Please restart this checkpoint.');
          const btn = document.getElementById(`ad-btn-${stepNum}`);
          btn.disabled = false;
          btn.textContent = 'Start Checkpoint';
          btn.style.background = '#ff3333';
          timer.style.display = 'none';
          return;
        }
        
        try {
          const response = await fetch(`${API_URL}/api/ad-verify`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionToken: sessionTokens[stepNum] })
          });
          
          const data = await response.json();
          
          if (data.completed) {
            clearInterval(pollIntervals[stepNum]);
            completeStep(stepNum, true);
          } else {
            const elapsed = Math.floor(attempts * 2);
            timer.textContent = `Waiting for completion... (${elapsed}s)`;
          }
        } catch (e) {
          console.error('Verification poll error:', e);
        }
      }, 2000); // Poll every 2 seconds
    }

    async function completeStep(stepNum, skipAPI = false) {
      const card = document.getElementById(`step-${stepNum}`);
      const btn = document.getElementById(`ad-btn-${stepNum}`);
      const timer = document.getElementById(`timer-${stepNum}`);

      // Clear polling interval if exists
      if (pollIntervals[stepNum]) {
        clearInterval(pollIntervals[stepNum]);
      }

      if (!skipAPI) {
        try {
          console.log('Completing checkpoint', stepNum);
          const response = await fetch(`${API_URL}/api/ad-complete`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionToken: sessionTokens[stepNum] })
          });

          const data = await response.json();
          console.log('Ad complete response:', data);

          if (!response.ok) {
            throw new Error(data.error || 'Failed to complete checkpoint');
          }
        } catch (e) {
          console.error('Error completing ad:', e);
          showError('Verification failed: ' + e.message);
          btn.disabled = false;
          btn.textContent = 'Start Checkpoint';
          btn.style.display = 'block';
          btn.style.background = '#ff3333';
          timer.style.display = 'none';
          return;
        }
      }

      card.classList.remove('active', 'loading');
      card.classList.add('completed');
      timer.style.display = 'none';
      btn.textContent = '‚úì Completed';
      btn.style.background = '#00ff00';
      btn.style.display = 'block';

      completedSteps++;
      updateProgress();

      if (stepNum < TOTAL_STEPS) {
        const next = stepNum + 1;
        document.getElementById(`step-${next}`).classList.add('active');
        document.getElementById(`ad-btn-${next}`).disabled = false;
      } else {
        setTimeout(() => generateKey(), 500);
      }
    }

    // ========================================
    // KEY GENERATION
    // ========================================
    function generateKey() {
      userHWID = generateHWID();
      console.log('Generated ALUCARD key:', userHWID);
      displaySuccess();
    }

    function displaySuccess() {
      document.getElementById('hwid-display').textContent = userHWID;
      document.getElementById('success-message').classList.add('show');
    }

    function copyHWID(event) {
      const hwid = document.getElementById('hwid-display').textContent;
      navigator.clipboard.writeText(hwid);
      const btn = event.target;
      const old = btn.textContent;
      btn.textContent = '‚úì Copied!';
      setTimeout(() => btn.textContent = old, 2000);
    }

    function goToDashboard() {
      const hwid = document.getElementById('hwid-display').textContent;
      navigator.clipboard.writeText(hwid).then(() => {
        window.location.href = 'dashboard.html';
      }).catch(() => {
        window.location.href = 'dashboard.html';
      });
    }

    // ========================================
    // URL PARAMETER HANDLING
    // ========================================
    // Check if user returned from ad link
    function checkReturnUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const verifyToken = urlParams.get('verify');
      
      if (verifyToken) {
        console.log('User returned from ad with token:', verifyToken);
        // The polling will detect the completion
        // Clean the URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    updateProgress();
    checkReturnUrl();
    
    document.getElementById('ad-btn-1').addEventListener('click', () => startAd(1));
    document.getElementById('ad-btn-2').addEventListener('click', () => startAd(2));
    document.getElementById('ad-btn-3').addEventListener('click', () => startAd(3));
  </script>
</body>
</html>
